% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/aplicacion-codificacion.R
\name{ppra_auditar}
\alias{ppra_auditar}
\title{Auditoría unificada de variables (SM, SO y OPEN) con soporte para Slim}
\usage{
ppra_auditar(
  df_or_res,
  path_instrumento,
  parent_var = NULL,
  uni_var = NULL,
  open_var = NULL,
  allowed_gap = 2,
  include_one_fallback = TRUE,
  include_open_suggestions = TRUE,
  min_single = 0.8,
  min_multi = 0.1,
  max_unique_for_one = 20,
  prefer = c("final", "data", "auto")
)
}
\arguments{
\item{df_or_res}{Entrada a auditar: un \code{data.frame}, una lista producida
por \code{ppra_adaptar_data()}, o una ruta a un archivo Excel (.xlsx).}

\item{path_instrumento}{Ruta al XLSForm (survey/choices) para detectar padres
de select-multiple y select-one.}

\item{parent_var}{Vector opcional de nombres de variables SM esperadas.
Si no se pasa y la entrada es una lista, se usan los de \code{multi_procesadas}.}

\item{uni_var}{Vector opcional de variables SO esperadas.
Si no se pasa y la entrada es lista, se usan los de \code{one_procesadas}.}

\item{open_var}{Vector opcional de variables abiertas a evaluar.
Si no se pasa y la entrada es lista, se usan los de \code{open_procesadas}.}

\item{allowed_gap}{Número máximo de columnas permitidas entre el bloque crudo
y el bloque recodificado (default = 2).}

\item{include_one_fallback}{¿Anotar posibles fallback de ONE desde plantilla?
(default = TRUE, sólo si se integra esa lógica).}

\item{include_open_suggestions}{¿Generar bloque de sugerencias OPEN?
(default = TRUE).}

\item{min_single}{Umbral mínimo de proporción de filas con 1 token para sugerir ONE
(default = 0.80).}

\item{min_multi}{Umbral mínimo de proporción de filas con >1 token para sugerir MULTIPLE
(default = 0.10).}

\item{max_unique_for_one}{Número máximo de categorías únicas aceptado para sugerir ONE
(default = 20).}

\item{prefer}{Qué dataset usar si se pasa una lista: \code{"final"} (slim),
\code{"data"} (completo) o \code{"auto"} (elige slim si existe).}
}
\value{
Un \code{tibble} con filas para cada variable auditada:
\itemize{
\item \code{type}: "multiple", "one" o "open_suggest".
\item \code{parent}: nombre de la variable auditada.
\item \code{esperado}: si estaba en los vectores declarados.
\item \code{raw_present}, \code{rec_present}: indicadores de columnas presentes.
\item \code{raw_range}, \code{rec_range}: rangos de posiciones de columnas.
\item \code{gap}, \code{ok_order}: métricas de orden/bloque.
\item \code{status}: estado ("codificado", "no_codificado", "missing_recod",
"one", "multiple", "undetermined").
\item \code{note}: anotaciones (ej. fallback, número de tokens únicos).
}
}
\description{
Esta función permite auditar la estructura de recodificación de un dataset
generado por \code{\link{ppra_adaptar_data}}. Es flexible en la entrada:
puede recibir directamente un \code{data.frame}, una lista retornada por
\code{ppra_adaptar_data()}, o una ruta a un archivo \code{.xlsx}.
}
\details{
\itemize{
\item Si se pasa una lista de \code{ppra_adaptar_data()}, por defecto se audita
el producto \code{final_data} ("slim"). Si no existe, se usa \code{data}.
\item Si se pasa un \code{.xlsx}, la función lo carga con \code{readxl}.
\item Si se pasa un \code{data.frame}, se usa directamente.
}

El reporte generado cubre:
\itemize{
\item Select-multiple (SM): verifica presencia de columnas hijas, bloques recodificados,
orden relativo, proporción de filas con datos, etc.
\item Select-one (SO): idem, además de detectar recodificación vía \code{_recod} y
\code{_recod_label}.
\item Abiertas (OPEN): genera sugerencias de si deberían ser tratadas como
\code{one} o \code{multiple}, en base a la distribución de tokens.
}
}
\examples{
\dontrun{
# Usando lista de ppra_adaptar_data
res <- ppra_adaptar_data(...)
aud <- ppra_auditar(res, path_instrumento = "instrumento.xlsx")

# Usando ruta a Excel final
aud <- ppra_auditar("DATA_ADAPTADA_SM_FINAL.xlsx", "instrumento.xlsx")

# Usando un data.frame en memoria
df <- readxl::read_xlsx("DATA_ADAPTADA_SM_FINAL.xlsx")
aud <- ppra_auditar(df, "instrumento.xlsx")
}

}
