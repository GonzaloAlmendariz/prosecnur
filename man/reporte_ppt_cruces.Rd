% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generador_ppt_cruces.R
\name{reporte_ppt_cruces}
\alias{reporte_ppt_cruces}
\title{Generar un reporte PPT a partir de cruces (SO/SM vs estrato) con graficadores propios}
\usage{
reporte_ppt_cruces(
  data,
  instrumento = NULL,
  secciones,
  var_cruce,
  path_ppt = "reporte_ppt_cruces.pptx",
  fuente = NULL,
  sm_vars_force = NULL,
  weight_col = "peso",
  mostrar_todo = FALSE,
  solo_lista = FALSE,
  incluir_titulo_var = TRUE,
  mensajes_progreso = TRUE,
  vars_dico = NULL,
  vars_barras_apiladas = NULL,
  vars_barras_agrupadas = NULL,
  vars_radar = NULL,
  listnames_dico = NULL,
  listnames_apiladas = NULL,
  dico_labels_por_var = list(),
  dico_labels_por_listname = list(),
  colores_apiladas_por_listname = list(),
  default_so = c("barras_agrupadas", "barras_apiladas"),
  default_sm = c("barras_agrupadas", "barras_apiladas"),
  barra_extra = c("ninguna", "total_n"),
  estilos_barras_agrupadas = list(),
  estilos_barras_apiladas = list(),
  estilos_dico = list(),
  colores_estratos = NULL,
  opciones_excluir = NULL,
  template_pptx = NULL,
  titulo_portada = NULL,
  subtitulo_portada = NULL,
  fecha_portada = NULL,
  mostrar_resumen_n = TRUE,
  labels_override = NULL
)
}
\arguments{
\item{data}{Data frame o tibble con la base de datos a cruzar. Debe contener
las variables de \code{secciones} y la variable \code{var_cruce}.}

\item{instrumento}{Objeto devuelto por \code{reporte_instrumento()}. Si es
\code{NULL}, se intentará recuperar desde \code{attr(data, "instrumento_reporte")}.
Debe contener al menos las tibbles \code{survey} y \code{choices} y,
opcionalmente, \code{orders_list}.}

\item{secciones}{Lista nombrada de secciones; cada elemento es un vector de
nombres de variables que se cruzarán con \code{var_cruce}.}

\item{var_cruce}{Nombre de la variable de estrato (columna de \code{data})
con la que se cruzarán todas las variables de \code{secciones}.}

\item{path_ppt}{Ruta del archivo PPTX a generar cuando \code{solo_lista = FALSE}.}

\item{fuente}{Texto de fuente que se mostrará en el bloque de texto inferior
izquierdo de cada diapositiva de gráficos.}

\item{sm_vars_force}{Vector opcional de nombres de variables que deben tratarse
como \code{select_multiple} aunque el instrumento no las marque como tales.}

\item{weight_col}{Nombre de la variable de pesos (por defecto \code{"peso"}).}

\item{mostrar_todo}{Reservado para coherencia; no se usa explícitamente en
esta función (el comportamiento depende de \code{get_categorias()}).}

\item{solo_lista}{Lógico; si \code{TRUE}, no se genera PPT y solo se devuelve
una lista con \code{plots} y \code{log_decisiones}. Si \code{FALSE}, además
se construye \code{path_ppt}.}

\item{incluir_titulo_var}{Lógico; si \code{TRUE}, el label de la variable se
usa como título de la diapositiva (placeholder de título). Los gráficos se
generan sin título interno.}

\item{mensajes_progreso}{Lógico; si \code{TRUE}, muestra mensajes por consola
indicando el tipo de gráfico usado para cada variable.}

\item{vars_dico}{Vector de nombres de variables que se deben graficar como
dicotómicas mediante \code{graficar_dico()}, siempre que exista una pareja
de etiquetas en \code{dico_labels_por_var} o \code{dico_labels_por_listname}.}

\item{vars_barras_apiladas}{Vector de nombres de variables que se deben
graficar como barras horizontales apiladas mediante
\code{graficar_barras_apiladas()}.}

\item{vars_barras_agrupadas}{Vector de nombres de variables que se deben
graficar como barras agrupadas mediante \code{graficar_barras_agrupadas()}.}

\item{vars_radar}{Reservado; actualmente no se implementa salida tipo radar.}

\item{listnames_dico}{Vector de \code{list_name} para los que, si una variable
no aparece en \code{vars_dico}, se intentará por defecto tratarla como
dicotómica.}

\item{listnames_apiladas}{Vector de \code{list_name} para los que, si una
variable no aparece en \code{vars_barras_apiladas} ni en \code{vars_dico},
se intentará por defecto graficar como barras apiladas.}

\item{dico_labels_por_var}{Lista nombrada donde cada elemento es un vector
de dos etiquetas \code{c("Positiva","Negativa")} para la variable
correspondiente.}

\item{dico_labels_por_listname}{Lista nombrada por \code{list_name} donde cada
elemento es un vector de dos etiquetas \code{c("Positiva","Negativa")} que
se usan cuando la variable no tiene entrada propia en \code{dico_labels_por_var}.}

\item{colores_apiladas_por_listname}{Lista nombrada por \code{list_name} donde
cada elemento puede ser:
\itemize{
\item Un vector nombrado de colores HEX (forma clásica).
\item Una lista con elementos \code{colores} y
\code{preset_barra_extra}, para controlar tanto colores como la
barra extra en \code{graficar_barras_apiladas()}.
}}

\item{default_so}{Tipo de gráfico por defecto para variables \code{select_one}
cuando no se encuentren en ninguna lista de overrides. Puede ser
\code{"barras_agrupadas"} o \code{"barras_apiladas"}.}

\item{default_sm}{Tipo de gráfico por defecto para variables \code{select_multiple}
cuando no se encuentren en ninguna lista de overrides. Igual que
\code{default_so}, puede ser \code{"barras_agrupadas"} o
\code{"barras_apiladas"}.}

\item{barra_extra}{Controla si se agrega o no una barra final con el N total
en barras apiladas/agrupadas (cuando no se usa un preset específico).
Puede ser:
\itemize{
\item \code{"ninguna"}: no se agrega barra extra.
\item \code{"total_n"}: se agrega barra extra con el N total (\code{"N = ..."}).
}}

\item{estilos_barras_agrupadas}{Lista de parámetros de estilo que se pasan
directamente a \code{graficar_barras_agrupadas()}.}

\item{estilos_barras_apiladas}{Lista de parámetros de estilo que se pasan
directamente a \code{graficar_barras_apiladas()}.}

\item{estilos_dico}{Lista de parámetros de estilo que se pasan directamente a
\code{graficar_dico()}.}

\item{colores_estratos}{Vector nombrado opcional de colores HEX para los
estratos en barras agrupadas (nombres = etiquetas de estrato). Si se
define \code{estilos_barras_agrupadas$colores_series}, tiene prioridad.}

\item{opciones_excluir}{Vector de labels de opciones a excluir de la
variable de interés (por ejemplo, categorías de no respuesta).}

\item{template_pptx}{Ruta a una plantilla PPTX (por ejemplo, en formato 16:9).
Si es \code{NULL}, se intentará usar una plantilla interna del paquete
llamada \code{"plantillas/plantilla_16_9.pptx"}; si tampoco existe, se
usará la plantilla por defecto de PowerPoint a través de \code{officer::read_pptx()}.}

\item{titulo_portada}{Título que se colocará en la diapositiva de portada
(layout \code{"Title Slide"}) cuando exista dicho layout en la plantilla.}

\item{subtitulo_portada}{Subtítulo para la diapositiva de portada.}

\item{fecha_portada}{Texto de fecha que se colocará en el placeholder de
fecha (\code{type = "dt"}) de la portada y, si existe, de la contraportada.}

\item{mostrar_resumen_n}{Lógico; si \code{TRUE}, en cada diapositiva de
gráficos se escribe en el bloque de texto inferior derecho un resumen del
tipo \code{"N = X | Ratio de respuestas: Y\%"}.}

\item{labels_override}{Lista nombrada opcional para sobrescribir etiquetas
de preguntas (se usa en los títulos de las diapositivas).}
}
\value{
Una lista con dos elementos:
\describe{
\item{plots}{Lista de objetos \code{ggplot} generados (uno por variable).}
\item{log_decisiones}{Tibble con información sobre cada variable procesada:
sección, nombre de variable, estrato, tipo de pregunta, \code{list_name},
origen de la decisión (\code{override}) y tipo de gráfico final.}
}
}
\description{
\code{reporte_ppt_cruces()} toma una base de datos, el instrumento, una definición
de secciones y una variable de cruce (\code{var_cruce}) y genera:
\itemize{
\item Una lista de gráficos \code{ggplot} (uno por variable de las secciones).
\item Opcionalmente, un archivo PPT donde cada gráfico ocupa una diapositiva.
}
}
\details{
A diferencia de \code{reporte_ppt()}, que trabaja con frecuencias simples,
esta función construye las tablas de cruce usando los mismos helpers que
\code{reporte_cruces()}:
\itemize{
\item \code{tipo_pregunta()}
\item \code{get_categorias()}
\item \code{contar_por_opcion()}
\item \code{denominador_validos()}
\item \code{.has_var_or_dummies()}
\item \code{label_variable()}
}

Para cada variable \code{v} en \code{secciones} se construye internamente
una tabla de cruce \code{v x var_cruce} con:
\itemize{
\item \code{categorias}: categorías de respuesta de \code{v}.
\item \code{estratos}: categorías de \code{var_cruce}.
\item \code{n_mat}: matriz de conteos (filas = categorías de \code{v},
columnas = estratos).
\item \code{N_estrato}: denominadores por estrato (vector nombrado).
}

A partir de esa tabla, se generan los insumos para los graficadores:
\itemize{
\item Barras apiladas:
\item Cada fila es un estrato (\code{categoria} = etiqueta del estrato),
\code{n_base} = \code{N_estrato[j]}.
\item Los segmentos son las categorías de la variable \code{v}.
\item Los colores de los segmentos se obtienen de
\code{colores_apiladas_por_listname[[list_name_v]]}, igual que en
\code{reporte_ppt()}, con soporte de objetos tipo
\code{list(colores = ..., preset_barra_extra = ...)}.
\item Barras agrupadas:
\item Cada fila es una categoría de \code{v}.
\item Las series son los estratos (una barra por estrato).
\item Los colores de las series se leen de
\code{estilos_barras_agrupadas$colores_series} o, si no existe,
de \code{colores_estratos}. En su defecto se usa una paleta por
defecto con nombres = etiquetas de estrato.
\item Dicotómicas:
\item Cada estrato es un "indicador" distinto.
\item Se calcula el porcentaje de la categoría "positiva" sobre el total
(positiva + negativa) en ese estrato.
\item Los colores se mantienen configurados por \code{estilos_dico}, igual
que en \code{reporte_ppt()}.
}

En todos los casos se eliminan:
\itemize{
\item Estratos con \code{N_estrato == 0} (no se grafican).
\item Categorías con suma de conteos 0 en todos los estratos.
}

La lógica de exportación a PPT (plantilla, layouts, portada, contraportada,
bloques de fuente y resumen de N) es idéntica a la de \code{reporte_ppt()}.
}
