% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generador_ppt.R
\name{reporte_ppt}
\alias{reporte_ppt}
\title{Generar un reporte PPT a partir de frecuencias (SO/SM) con graficadores propios}
\usage{
reporte_ppt(
  data,
  instrumento = NULL,
  secciones = NULL,
  path_ppt = "reporte_ppt.pptx",
  fuente = NULL,
  sm_vars_force = NULL,
  mostrar_todo = FALSE,
  solo_lista = FALSE,
  incluir_titulo_var = TRUE,
  mensajes_progreso = TRUE,
  vars_dico = NULL,
  vars_barras_apiladas = NULL,
  vars_barras_agrupadas = NULL,
  vars_radar = NULL,
  listnames_dico = NULL,
  listnames_apiladas = NULL,
  dico_labels_por_var = list(),
  dico_labels_por_listname = list(),
  colores_apiladas_por_listname = list(),
  default_so = c("barras_agrupadas", "barras_apiladas"),
  default_sm = c("barras_agrupadas", "barras_apiladas"),
  barra_extra = c("ninguna", "total_n"),
  estilos_barras_agrupadas = list(),
  estilos_barras_apiladas = list(),
  estilos_dico = list(),
  template_pptx = NULL,
  titulo_portada = NULL,
  subtitulo_portada = NULL,
  fecha_portada = NULL,
  titulo_contraportada = NULL,
  subtitulo_contraportada = NULL,
  fecha_contraportada = NULL,
  layout_titulo = "Title Slide",
  layout_section = "Section Header",
  layout_grafico = "Graficos",
  layout_contraportada = "Contraportada",
  master_ppt = "Office Theme"
)
}
\arguments{
\item{data}{Data frame o tibble con la base de reporte (idealmente el
resultado de \code{reporte_data()}), que contiene los atributos \code{label}
y \code{labels} en sus variables.}

\item{instrumento}{Objeto devuelto por \code{reporte_instrumento()}. Si es
\code{NULL}, se intentará recuperar desde \code{attr(data, "instrumento_reporte")}.
Debe contener al menos las tibbles \code{survey} y \code{choices}, y,
opcionalmente, \code{orders_list}.}

\item{secciones}{Lista nombrada que define qué variables se incluyen en cada
sección, de forma análoga a \code{reporte_frecuencias()}. Si es \code{NULL},
se intentará inferir desde una columna \code{section} o \code{seccion} del
\code{survey}.}

\item{path_ppt}{Ruta del archivo PPTX a generar cuando \code{solo_lista = FALSE}.}

\item{fuente}{Texto de fuente que se mostrará como nota al pie de cada gráfico
(en \code{plot.caption}).}

\item{sm_vars_force}{Vector opcional de nombres de variables que deben tratarse
como \code{select_multiple} aunque el instrumento no las marque como tales.}

\item{mostrar_todo}{Lógico; se pasa a \code{freq_table_spss()} como
\code{mostrar_todo}. Controla si las tablas de frecuencias incluyen
categorías con frecuencia 0 definidas en el instrumento. En todos los casos,
el generador de PPT excluye categorías con \code{n == 0} al graficar.}

\item{solo_lista}{Lógico; si \code{TRUE}, no se genera PPT y solo se devuelve
una lista con \code{plots} y \code{log_decisiones}. Si \code{FALSE}, además
se construye \code{path_ppt}.}

\item{incluir_titulo_var}{Lógico; si \code{TRUE}, cada gráfico usa como título
el label de la variable (obtenido a partir del \code{survey} o de los
atributos de la base). Si \code{FALSE}, los gráficos se generan sin título.}

\item{mensajes_progreso}{Lógico; si \code{TRUE}, muestra mensajes por sección
y por variable indicando qué tipo de gráfico se está usando y por qué.}

\item{vars_dico}{Vector de nombres de variables que se deben graficar como
dicotómicas mediante \code{graficar_dico()}, siempre que exista una pareja
de etiquetas en \code{dico_labels_por_var} o \code{dico_labels_por_listname}.}

\item{vars_barras_apiladas}{Vector de nombres de variables que se deben
graficar como barras horizontales apiladas mediante
\code{graficar_barras_apiladas()}.}

\item{vars_barras_agrupadas}{Vector de nombres de variables que se deben
graficar como barras agrupadas mediante \code{graficar_barras_agrupadas()}.}

\item{vars_radar}{Vector de nombres de variables que se desean reservar para
un tratamiento tipo radar. Actualmente se registra en el log, pero no se
construye automáticamente una tabla para \code{graficar_radar()}.}

\item{listnames_dico}{Vector de \code{list_name} (del \code{survey}) para los
que, si una variable no aparece en \code{vars_dico}, se intentará por
defecto tratarla como dicotómica.}

\item{listnames_apiladas}{Vector de \code{list_name} para los que, si una
variable no aparece en \code{vars_barras_apiladas} ni en \code{vars_dico},
se intentará por defecto graficar como barras apiladas.}

\item{dico_labels_por_var}{Lista nombrada donde cada elemento es un vector
de dos etiquetas \code{c("Positiva","Negativa")} para la variable
correspondiente.}

\item{dico_labels_por_listname}{Lista nombrada por \code{list_name} donde cada
elemento es un vector de dos etiquetas \code{c("Positiva","Negativa")} que
se usan cuando la variable no tiene entrada propia en \code{dico_labels_por_var}.}

\item{colores_apiladas_por_listname}{Lista nombrada por \code{list_name} donde
cada elemento es un vector de colores HEX con nombre para los segmentos de
las barras apiladas. Los nombres de estos colores deben coincidir con los
labels de las categorías (\code{Opciones}) que se graficarán.}

\item{default_so}{Tipo de gráfico por defecto para variables \code{select_one}
cuando no se encuentren en ninguna lista de overrides. Puede ser
\code{"barras_agrupadas"} o \code{"barras_apiladas"}.}

\item{default_sm}{Tipo de gráfico por defecto para variables \code{select_multiple}
cuando no se encuentren en ninguna lista de overrides. Igual que
\code{default_so}, puede ser \code{"barras_agrupadas"} o
\code{"barras_apiladas"}.}

\item{barra_extra}{Controla si se agrega o no una barra final con el N total
en las barras apiladas. Puede ser:
\itemize{
\item \code{"ninguna"}: no se agrega barra extra.
\item \code{"total_n"}: se agrega barra extra con el N total (\code{"N = ..."}).
}}

\item{estilos_barras_agrupadas}{Lista de parámetros de estilo que se pasan
directamente a \code{graficar_barras_agrupadas()}.}

\item{estilos_barras_apiladas}{Lista de parámetros de estilo que se pasan
directamente a \code{graficar_barras_apiladas()}.}

\item{estilos_dico}{Lista de parámetros de estilo que se pasan directamente a
\code{graficar_dico()}.}

\item{template_pptx}{Ruta a una plantilla PPTX (por ejemplo, en formato 16:9).
Si es \code{NULL}, se intentará usar una plantilla interna del paquete
llamada \code{"plantillas/plantilla_16_9.pptx"}; si tampoco existe, se
usará la plantilla por defecto de PowerPoint a través de
\code{officer::read_pptx()}.}

\item{layout_section}{Nombre del layout para las diapositivas de sección
(por defecto \code{"Section Header"}).}

\item{layout_contraportada}{Nombre del layout para la diapositiva de
contraportada (por defecto \code{"Contraportada"}).}

\item{master_ppt}{Nombre del master de la plantilla (por defecto
\code{"Office Theme"}).}

\item{layout_title}{Nombre del layout de portada (por defecto \code{"Title Slide"}).}

\item{layout_graficos}{Nombre del layout para las diapositivas de gráficos
(por defecto \code{"Graficos"}).}
}
\value{
Una lista con dos elementos:
\describe{
\item{plots}{Lista de objetos \code{ggplot} generados (uno por variable).}
\item{log_decisiones}{Tibble con información sobre cada variable procesada:
sección, nombre de variable, tipo de pregunta, \code{list_name},
origen de la decisión (\code{override}) y tipo de gráfico final.}
}
}
\description{
\code{reporte_ppt()} toma una base de reporte (idealmente la misma que se usa en
\code{reporte_frecuencias()}), el instrumento y una definición de secciones, y
genera:
\itemize{
\item Una lista de gráficos \code{ggplot} (uno por variable válida).
\item Opcionalmente, un archivo PPT donde cada gráfico ocupa una diapositiva.
}
}
\details{
El tipo de gráfico para cada variable se decide en tres niveles:
\enumerate{
\item Sobrescritura explícita por variable:
\itemize{
\item \code{vars_dico}: variables que deben usarse como dicotómicas
con \code{graficar_dico()}.
\item \code{vars_barras_apiladas}: variables para \code{graficar_barras_apiladas()}.
\item \code{vars_barras_agrupadas}: variables para \code{graficar_barras_agrupadas()}.
\item \code{vars_radar}: reservado para futuros usos (por ahora no se
construye tabla radar automáticamente).
}
\item Decisión por \code{list_name} de la pregunta en el instrumento:
\itemize{
\item \code{listnames_dico}: todas las variables cuyo \code{list_name}
esté aquí tienden a graficarse como dicotómicas.
\item \code{listnames_apiladas}: todas las variables cuyo \code{list_name}
esté aquí tienden a graficarse como barras apiladas.
}
\item Defaults por tipo de pregunta:
\itemize{
\item \code{default_so}: tipo de gráfico por defecto para \code{select_one}.
\item \code{default_sm}: tipo de gráfico por defecto para \code{select_multiple}.
}
}

Para las variables dicotómicas, \strong{no se asume ninguna pareja de categorías
por defecto}. En su lugar, se requiere que este par se defina explícitamente en:
\itemize{
\item \code{dico_labels_por_var[[var]]} (prioridad más alta), o
\item \code{dico_labels_por_listname[[list_name]]}.
}
Si no se encuentra una pareja de etiquetas válida, la variable se grafica con
el tipo de barras por defecto (típicamente \code{"barras_agrupadas"}), dejando
constancia en \code{log_decisiones}.

Internamente, las tablas de frecuencias se construyen con
\code{freq_table_spss()}, por lo que solo se grafican variables que:
\itemize{
\item Existen como columna en \code{data}, o
\item Tienen dummies asociadas (\code{var/cod} o \code{var.cod}) para
el caso de \code{select_multiple}.
}
}
