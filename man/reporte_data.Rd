% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generalidad_data.R
\name{reporte_data}
\alias{reporte_data}
\title{Adaptar la base para reporte y estructura tipo SPSS}
\usage{
reporte_data(
  data,
  instrumento,
  var_peso = NULL,
  dummy_vars = NULL,
  dummies_na_to_zero = TRUE
)
}
\arguments{
\item{data}{Un \code{data.frame} o \code{tibble} que contenga la base de datos ya
adaptada (nombres finales de variables) tras las fases de consistencia y
recodificación.}

\item{instrumento}{Objeto devuelto por \code{\link[=reporte_instrumento]{reporte_instrumento()}}, que
contiene los metadatos del XLSForm (survey, choices, diccionarios, etc.).}

\item{var_peso}{(Opcional) Nombre de la variable de peso en \code{data}. Si se
proporciona y existe en la base, se registra como atributo \code{var_peso}.}

\item{dummy_vars}{(Opcional) Vector con nombres adicionales de variables
dummy (0/1) a las que se desee asignar etiquetas de valor genéricas
\code{"No"} / \code{"Sí"}. Todas las variables cuyo nombre contenga \code{"/"} se tratan
automáticamente como dummies de \code{select_multiple}, por lo que este
argumento es únicamente complementario.}

\item{dummies_na_to_zero}{(Obsoleto) Se mantiene por compatibilidad, pero
la lógica actual trata las filas sin ninguna opción marcada como \code{NA}
en todas las dummies, independientemente de este argumento.}
}
\value{
El mismo objeto \code{data} pero:
\itemize{
\item Con variables \code{select_one} en códigos cuando se detectan labels
provenientes del instrumento.
\item Con dummies 0/1 de \code{select_multiple} renombradas \code{var.codigo}
(punto) y etiquetadas con \code{label} (texto de la opción) y
\code{labels} = \code{"No"} / \code{"Sí"}.
\item Sin variables madre de \code{select_multiple} (ni originales ni
recodificadas): solo se conservan las dummies.
\item Con atributos \code{label}, \code{labels} y \code{measure} según el instrumento,
completando \code{measure} faltante con una heurística coherente con
SPSS cuando no hay regla explícita.
\item Con atributos a nivel de objeto:
\describe{
\item{instrumento_reporte}{Metadatos completos del instrumento.}
\item{var_peso}{Nombre de la variable de peso (si se proporcionó).}
\item{vars_fecha}{Variables declaradas como fecha en el instrumento.}
\item{vars_hora}{Variables declaradas como hora.}
\item{vars_datetime}{Variables declaradas como fecha-hora.}
}
\item Con clase adicional \code{"prosecnur_reporte_tbl"} para facilitar su uso
en otras funciones de reporte.
}
}
\description{
\code{reporte_data()} toma una base de datos ya adaptada (tras la evaluación de
consistencia y la recodificación/adaptación del instrumento y la data) y un
objeto de instrumento creado con \code{\link[=reporte_instrumento]{reporte_instrumento()}}, y realiza tres
tareas principales:
\enumerate{
\item Asigna metadatos: etiquetas de variables (\code{label}), etiquetas de
valor (\code{labels}) y nivel de medición sugerido (\code{measure}).
\item Adapta las variables de elección única (\code{select_one}) para que
utilicen códigos en lugar de etiquetas, solo cuando detecta que en
la base hay valores que coinciden con las etiquetas del instrumento.
Los códigos ya presentes se conservan sin modificación.
\item Normaliza las variables derivadas de \code{select_multiple}:
dummies en 0/1, con \code{label} de la opción, \code{labels} = \code{"No"/"Sí"},
y nombres \code{var.codigo} (punto) en lugar de \code{var/opción}. La lógica
de valores es:
\itemize{
\item \code{1} = opción marcada;
\item \code{0} = opción no marcada, pero se marcó alguna otra opción
en esa pregunta;
\item \code{NA} = la pregunta no fue respondida (ninguna opción
marcada, todas las dummies quedan en \code{NA}).
}
Si existen variables madre (\code{var} o \code{var_recod}) se usan para
generar dummies y luego se eliminan, de modo que en la base final
solo queden las dummies.
}
}
\details{
La función no escribe ningún archivo ni crea objetos \code{labelled_spss}. La
conversión final a objetos SPSS (por ejemplo con \code{\link[haven:labelled_spss]{haven::labelled_spss()}})
debe realizarse en una etapa posterior (por ejemplo, en una función
\code{reporte_spss()}).
}
