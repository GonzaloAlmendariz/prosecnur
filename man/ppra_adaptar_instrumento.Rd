% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/aplicacion-codificacion-instrumento.R
\name{ppra_adaptar_instrumento}
\alias{ppra_adaptar_instrumento}
\title{Adaptar un XLSForm con variables recodificadas}
\usage{
ppra_adaptar_instrumento(
  path_instrumento_in,
  path_data_adaptada,
  path_instrumento_out = "instrumento_adaptado.xlsx",
  parent_var = NULL,
  uni_var = NULL,
  open_var = NULL,
  labels_append_recode = TRUE,
  paint = TRUE,
  choices_order = c("original_first", "by_first_seen", "alphabetical")
)
}
\arguments{
\item{path_instrumento_in}{Ruta al XLSForm original (XLSX con hojas \code{survey} y \code{choices}).}

\item{path_data_adaptada}{Ruta al XLSX con la data adaptada (o un \code{data.frame}). Debe contener solo
las columnas padre \code{*_recod} (por ejemplo, salida \code{final_data} de \code{ppra_adaptar_data}).}

\item{path_instrumento_out}{Ruta de salida para el XLSForm adaptado (XLSX).}

\item{parent_var}{Vector de \emph{select_multiple} a reflejar como \code{<parent>_recod}.}

\item{uni_var}{Vector de \emph{select_one} a reflejar como \code{<parent>_recod}.}

\item{open_var}{Vector de variables abiertas \code{<detail>} cuya \code{<detail>_recod} debe incorporarse.}

\item{labels_append_recode}{\code{logical}. Si \code{TRUE}, en \code{choices} se intentan replicar las
etiquetas de las opciones existentes para las nuevas \code{*_recod}; las desconocidas se crean con label vacío.}

\item{paint}{\code{logical}. Si \code{TRUE}, colorea las filas nuevas en \code{survey}/\code{choices}
según el tipo: \emph{select_multiple} (verde pastel) y \emph{select_one} (azul pastel).}

\item{choices_order}{Cadena con el orden de mezcla en \code{choices}: \code{"original_first"},
\code{"recode_first"} o \code{"append_only"}.}
}
\value{
(Invisiblemente) una lista con:
\itemize{
\item \code{survey}: \code{tibble} de la hoja \code{survey} adaptada.
\item \code{choices}: \code{tibble} de la hoja \code{choices} adaptada.
\item \code{path}: ruta escrita del archivo XLSX de salida.
}
}
\description{
Toma un XLSForm de entrada (\code{survey}/\code{choices}) y una base \strong{ya adaptada}
(salida de \code{ppra_adaptar_data}) y genera un instrumento actualizado que
incluye las nuevas variables recodificadas:
\itemize{
\item Para \emph{select_multiple}: agrega \code{<parent>_recod}.
\item Para \emph{select_one}: agrega \code{<parent>_recod} (y opcionalmente su label).
\item Para abiertas (\code{open_var}): se decide si su \code{<detail>_recod}
se comporta como \emph{select_one} o \emph{select_multiple} según el
número de tokens (separados por espacio) en la columna \code{*_recod}.
}
Las nuevas preguntas se insertan en \code{survey} inmediatamente \strong{después}
de la original y las opciones nuevas se añaden en \code{choices} (si faltan
labels para opciones nuevas, se dejan vacíos para completarlos manualmente).
}
\details{
\strong{Determinación del tipo para \code{open_var}}:
si la columna \code{<detail>_recod} tiene, por fila, más de un código (tokens
separados por espacio), se clasifica como \emph{select_multiple}; si la gran
mayoría son de un único token, se considera \emph{select_one}.

\strong{List names}: para \emph{select_multiple} se usa el \code{list_name}
del \code{parent} original; para nuevas opciones se añade el \code{name}
(código) y se deja el \code{label} vacío cuando no exista.
}
\examples{
\dontrun{
res_inst <- ppra_adaptar_instrumento(
  path_instrumento_in  = "instrumento_pdm.xlsx",
  path_data_adaptada   = "DATA_ADAPTADA_SM_FINAL.xlsx",
  path_instrumento_out = "instrumento_pdm_ADAPTADO.xlsx",
  parent_var = c("Cash_purpose","Who_gave_help"),
  uni_var    = c("Possession_payment_mechanism"),
  open_var   = c("Increase_in_prices_details"),
  labels_append_recode = TRUE,
  paint = TRUE,
  choices_order = "original_first"
)
}
}
\seealso{
\code{\link{ppra_adaptar_data}}, \code{\link{ppra_auditar}}
}
