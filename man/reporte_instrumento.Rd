% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generalidad_lectura.R
\name{reporte_instrumento}
\alias{reporte_instrumento}
\title{Construir objeto de metadatos a partir de un XLSForm (fase de reporte)}
\usage{
reporte_instrumento(
  path,
  sheet_survey = "survey",
  sheet_choices = "choices",
  lang = "es",
  prefer_label = NULL,
  listas_ordinales = NULL,
  vars_fecha = NULL,
  vars_hora = NULL,
  vars_datetime = NULL
)
}
\arguments{
\item{path}{Ruta al archivo \code{.xlsx} del formulario (XLSForm). Debe contener
al menos las hojas \code{survey} y \code{choices}.}

\item{sheet_survey}{Nombre de la hoja que contiene la sección survey.
Por defecto \code{"survey"}.}

\item{sheet_choices}{Nombre de la hoja que contiene la sección choices.
Por defecto \code{"choices"}.}

\item{lang}{Código de idioma que se usará para seleccionar la columna de
etiquetas (\code{label::es}, \code{label::en}, etc.). Por defecto \code{"es"}.}

\item{prefer_label}{Nombre exacto de la columna de etiqueta a priorizar.
Si no es \code{NULL}, se usa esta columna siempre que exista; de lo contrario
se intenta detectar automáticamente una columna \verb{label::[lang]} o \code{label}.}

\item{listas_ordinales}{Vector opcional con los nombres de \code{list_name} que
deben tratarse como ordinales al sugerir niveles de medición.}

\item{vars_fecha}{Vector opcional con los nombres de variables que deben
tratarse como fechas (por ejemplo, para su conversión posterior a \code{Date}).}

\item{vars_hora}{Vector opcional con los nombres de variables que deben
tratarse como horas (por ejemplo, para su conversión posterior a \code{hms}).}

\item{vars_datetime}{Vector opcional con los nombres de variables que deben
tratarse como fecha-hora (por ejemplo, para su conversión posterior a
\code{POSIXct}).}
}
\value{
Un objeto de clase \code{"prosecnur_instrumento"} que es una lista con,
al menos, los siguientes componentes:
\describe{
\item{path}{Ruta del archivo XLSForm utilizado.}
\item{lang}{Idioma seleccionado.}
\item{label_col_survey}{Nombre de la columna de etiqueta seleccionada
para la hoja \code{survey}.}
\item{label_col_choices}{Nombre de la columna de etiqueta seleccionada
para la hoja \code{choices}.}
\item{survey}{Tabla \code{survey} con columnas \code{name}, \code{type}, \code{list_name},
\code{label} y otras columnas originales, además de \code{measure_sugerida}.}
\item{choices}{Tabla \code{choices} con columnas \code{list_name}, \code{name},
\code{label} y columnas adicionales.}
\item{var_labels}{Vector nombrado \code{nombre_variable -> etiqueta}.}
\item{dicc_label_to_code}{Lista nombrada por \code{list_name} con vectores
\code{label -> code}.}
\item{dicc_code_to_label}{Lista nombrada por \code{list_name} con vectores
\code{code -> label}.}
\item{orders_list}{Lista nombrada por variable, con elementos que
contienen \code{names} (códigos), \code{labels} (etiquetas) y \code{label}
(etiqueta de la pregunta).}
\item{measure_rules}{Tabla con \code{name}, \code{type}, \code{list_name} y
\code{measure_sugerida}.}
\item{vars_fecha}{Vector con los nombres de las variables declaradas
como fecha.}
\item{vars_hora}{Vector con los nombres de las variables declaradas
como hora.}
\item{vars_datetime}{Vector con los nombres de las variables declaradas
como fecha-hora.}
}
}
\description{
\code{reporte_instrumento()} lee las hojas \code{survey} y \code{choices} de un XLSForm
y construye un objeto de metadatos que concentra etiquetas de preguntas,
listas de opciones y órdenes de respuesta.
}
\details{
Esta función está pensada como parte de una tercera fase del flujo de trabajo:
se aplica de forma general sobre el instrumento luego de los procesos de
evaluación de consistencia y de recodificación/adaptación del instrumento y
de la base de datos. Su objetivo es entregar un objeto estable de metadatos
que sirva como entrada para la generación de libros de códigos, tablas de
frecuencias, cruces y exportaciones a otros formatos.

A diferencia de una detección automática, las variables de fecha y hora se
declaran explícitamente mediante los argumentos \code{vars_fecha}, \code{vars_hora} y
\code{vars_datetime}.
}
\examples{
\dontrun{
instr <- reporte_instrumento(
  path            = "OPS_EES_instrumento_CODE.xlsx",
  lang            = "es",
  listas_ordinales = c("frecuencia", "acuerdo"),
  vars_fecha       = c("fecha_visita"),
  vars_hora        = c("hora_inicio", "hora_fin")
)
names(instr$var_labels)
}
}
