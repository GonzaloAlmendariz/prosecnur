% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/codificacion.R
\name{leer_familias_clasificar}
\alias{leer_familias_clasificar}
\title{Leer y \strong{clasificar} el Excel de familias (con adopciones y huérfanas)}
\usage{
leer_familias_clasificar(path, inst, dat, sheet = "familias", verbose = TRUE)
}
\arguments{
\item{path}{\code{character}. Ruta al Excel de familias (p. ej. \code{"familias.xlsx"}).}

\item{inst}{\code{list}. Instrumento XLSForm leído con tu “lector minimalista”; debe contener
al menos \code{$survey}, \code{$choices} (idealmente también \code{$survey\_raw}, \code{$choices\_raw}).}

\item{dat}{\code{list}. Objeto devuelto por \code{leer_datos()} con \code{$raw} (y usualmente \code{$name\_map}).}

\item{sheet}{\code{character}. Nombre de la hoja a leer del Excel de familias. Default: \code{"familias"}.}

\item{verbose}{\code{logical}. Si \code{TRUE}, imprime un resumen y ejemplos de adopciones/huérfanas. Default: \code{TRUE}.}
}
\value{
\code{list} con los elementos:
\describe{
\item{\code{familias\_filtradas}}{Tibble con las filas aceptadas (SO/SM/TEXT), tras aplicar reglas y existencia en datos.}
\item{\code{select\_multiple}}{Subconjunto aceptado de \code{familias\_filtradas} para \code{tipo == "select_multiple"}.}
\item{\code{select\_one}}{Subconjunto aceptado de \code{familias\_filtradas} para \code{tipo == "select_one"}.}
\item{\code{text}}{Subconjunto aceptado de \code{familias\_filtradas} para \code{tipo == "text"}
(solo \emph{huérfanas}, i.e., no usadas como \code{text_col} en SO/SM con \code{use=TRUE}).}
\item{\code{familias\_enriquecidas}}{Tibble con \code{parent\_label\_es} y banderas \code{falta\_dummy\_sm}, \code{falta\_text}.}
\item{\code{choices\_usadas}}{Tibble con \code{parent}, \code{parent\_col}, \code{list\_norm}, \code{code}, \code{label\_es}
para las listas utilizadas por las familias aceptadas.}
\item{\code{adopciones}}{Tibble de mapeo de \code{text_col} adoptadas: incluye \code{adoptada\_por\_parent},
\code{adoptada\_por\_label}, \code{tipo\_padre} y si el \emph{padre} existe en los datos.}
\item{\code{textos\_huerfanos}}{Tibble con \code{text_col} de \code{tipo == "text"} que quedaron sin adopción y motivo.}
\item{\code{resumen}}{Tibble con contadores: totales aceptados por tipo, excluidas, \#adopciones y \#huérfanas.}
}
}
\description{
Lee la hoja \code{sheet} de un Excel de familias ya editado por la persona usuaria
y devuelve subconjuntos listos para construir la plantilla de codificación,
además de avisos útiles sobre \emph{adopciones} (qué \code{text_col} fue
adoptada por qué SO/SM) y \emph{textos huérfanos} (text sin padre asignado).
}
\details{
La función:
\itemize{
\item Normaliza levemente las columnas de la hoja \code{sheet} (\code{use}, \code{tipo}, etc.).
\item Verifica si \code{parent_col}, \code{text_col} y \code{other_dummy_col} existen en \code{dat$raw}.
\item Acepta filas \strong{select\_multiple} solo si existen \code{text_col} y \code{other_dummy_col}.
\item Acepta filas \strong{select\_one} solo si existe \code{text_col}.
\item Considera \strong{text} finales únicamente si NO aparecen como \code{text_col}
de alguna SO/SM con \code{use = TRUE} (es decir, ya “adoptadas”).
\item Construye un cuadro de \strong{adopciones} (quién adopta a quién) y otro de
\strong{textos huérfanos} (text que no fueron adoptadas por ninguna SO/SM).
\item Enriquece \code{parent\_label\_es} desde el XLSForm (\code{inst$survey\_raw} en español
cuando es posible; si no, \code{inst$survey}).
\item Devuelve un catálogo de \emph{choices} utilizadas (por \code{list\_norm}) para las familias aceptadas.
}
}
\section{Reglas de aceptación}{

\itemize{
\item \strong{select\_multiple}: \code{use == TRUE} \emph{y} existen \code{text_col} \emph{y} \code{other_dummy_col} en \code{dat$raw}.
\item \strong{select\_one}: \code{use == TRUE} \emph{y} existe \code{text_col} en \code{dat$raw}.
\item \strong{text}: \code{use == TRUE} \emph{y} su \code{text_col} \emph{no} aparece como hija de una SO/SM aceptada.
}
}

\examples{
\dontrun{
inst <- leer_instrumento_xlsform("instrumento.xlsx")
dat  <- leer_datos("datos.xlsx")
fams <- leer_familias_clasificar("familias.xlsx", inst = inst, dat = dat, sheet = "familias")

# inspección rápida:
fams$resumen
head(fams$adopciones)
head(fams$textos_huerfanos)
}

}
\seealso{
\code{\link{construir_plantilla_desde_familias}}, \code{\link{escribir_plantilla_familias}}
}
