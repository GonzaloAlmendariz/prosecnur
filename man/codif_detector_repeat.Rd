% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/codificacion.R
\name{codif_detector_repeat}
\alias{codif_detector_repeat}
\title{Detectar secciones repeat y relaciones SO/SM↔TEXT en el instrumento}
\usage{
codif_detector_repeat(
  inst,
  sufijos_text = c("_other", "_otra", "_otro", "_specify", "_text", "_why")
)
}
\arguments{
\item{inst}{list. Instrumento leído (debes tener \code{inst$survey}), tal como lo entrega
\code{leer_instrumento_xlsform()}. No se requiere normalización adicional.}

\item{sufijos_text}{character. Sufijos a considerar como texto asociado a un select.
Default: c("_other","_otra","_otro","_specify","_text","_why")}
}
\value{
Un tibble con una fila por variable de \code{survey} y columnas:
\describe{
\item{var_name}{Nombre según \code{survey$name} (original).}
\item{var_clean}{Nombre normalizado (coincide con \code{janitor::make_clean_names(survey$name)}).}
\item{type_base}{Primer token de \code{type}.}
\item{repeat_section}{Nombre de la sección repeat a la que pertenece o "main".}
\item{hoja_esperada}{Nombre de hoja donde se espera encontrar datos (igual a \code{repeat_section}).}
\item{is_repeat}{TRUE si la variable está dentro de un repeat.}
\item{is_select}{TRUE si \code{type_base} es select_one o select_multiple.}
\item{is_text}{TRUE si \code{type_base} es text.}
\item{is_calc}{TRUE si \code{type_base} es calculate.}
\item{parent_select}{Para TEXT: nombre del select asociado. Para SELECT: su propio nombre.}
\item{parent_text}{Para SELECT: texto asociado si existe (por sufijos). Para TEXT: su propio nombre.}
}
}
\description{
Escanea la hoja \code{survey} del XLSForm para clasificar cada variable por:
\itemize{
\item \code{type_base} (select_one, select_multiple, text, calculate, etc.)
\item \code{repeat_section} (nombre de la sección repeat a la que pertenece, o "main")
\item \code{hoja_esperada} (igual a \code{repeat_section}, usable para enrutar a la hoja de datos)
\item banderas \code{is_repeat}, \code{is_select}, \code{is_text}, \code{is_calc}
\item relación padre→texto asociado: \code{parent_select} y \code{parent_text} (p.ej. *_other/_why/_specify/_text)
}
}
\details{
La detección de secciones se basa exclusivamente en los pares \verb{begin repeat} / \verb{end repeat}
(también acepta \code{begin_repeat}/\code{end_repeat}). El enlace SO/SM→TEXT se resuelve por sufijos
comunes dentro de \strong{la misma sección}.
}
\examples{
\dontrun{
inst <- leer_instrumento_xlsform("RMS_instrumento.xlsx")
det  <- codif_detector_repeat(inst)
dplyr::count(det, repeat_section, type_base)
det \%>\% dplyr::filter(is_select) \%>\% dplyr::select(repeat_section, var_name, parent_text)
}
}
